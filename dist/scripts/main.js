function BlinkersVennColumnsChart(){function t(t){d3.select("#chart svg").remove(),r.forEach(function(t){y[t.name]=t}),p.range(m),t.each(function(){function t(){d3.selectAll(".gnode text").transition().duration(100).text(function(t){return n(t.name)}).style("font-size",function(t){return t.computedFontSize})}function l(t){R.each(c(.2*t.alpha)).each(m(.5)),R.attr("transform",function(t){return"translate("+[t.x,t.y]+")"})}function c(t){return function(n){n.y+=(n.cy-n.y)*t,n.x+=(n.cx-n.x)*t,n.x=Math.max(n.radius+1,Math.min(e-n.radius,n.x)),n.y=Math.max(n.radius+1,Math.min(o-n.radius,n.y))}}function m(t){var n=d3.geom.quadtree(r);return function(r){var e=r.radius+u+i,a=r.x-e,o=r.x+e,s=r.y-e,l=r.y+e;n.visit(function(n,e,u,c,d){if(n.point&&n.point!==r){var f=r.x-n.point.x,m=r.y-n.point.y,p=Math.sqrt(f*f+m*m),h=r.radius+n.point.radius+i;h>p&&(p=(p-h)/p*t,r.x-=f*=p,r.y-=m*=p,n.point.x+=f,n.point.y+=m)}return e>o||a>c||u>l||s>d})}}function y(){e=window.innerWidth-2*d,e=Math.max(a,e),e||(e=a),h.rangeBands([0,e]),w=d3.range(r.length).map(function(t){var a=r[t];return a.radius=v(n(r[t].name).length),a.color=p(a.set),a.cx=h(a.set)+e/6,a.cy=o/2,a.name=a.name,a}),x.attr("width",e),z.size([e,o]).resume(),b.attr("transform",function(t,n){return"translate("+(h(n)+e/6)+",20)"}),B.attr("transform",function(t,n){return"translate("+(h(1)+e/6)+","+o+")"})}{var x=d3.select(this).append("svg").attr("width",e).attr("height",o),v=d3.scale.linear().domain([d3.min(r,function(t){return n(t.name).length}),d3.max(r,function(t){return n(t.name).length})]).range([s,u]),w=d3.range(r.length).map(function(t){var a=r[t];return a.radius=v(n(a.name).length),a.color=p(a.set),a.cx=h(a.set)+e/6,a.cy=o/2,a.name=a.name,a}),z=d3.layout.force().nodes(w).size([e,o]).gravity(0).charge(function(t){return-Math.pow(t.radius,2)/8}).friction(.9).on("tick",l).start(),C=p.range().map(function(t,n){return{radius:Math.sqrt(50)*u,color:t,set:n}}),M=x.selectAll("g.vennCircle").data(C).enter().append("g"),b=M.append("g").attr("transform",function(t,n){return"translate("+(h(n)+e/6)+",20)"});b.append("text").attr("class","vennLabel").text(function(t){return g[t.set]}).style("font-size",function(t){return"16px"}).attr("fill-opacity",1).attr("dy",".35em")}b.append("rect").style("fill",function(t){return t.color}).attr("opacity",1).attr("height",10).attr("width",200).attr("rx",3).attr("ry",3).attr("x",-100).attr("y",-20);for(var A=0,L=0,k=0,q=0;q<r.length;q++)1==r[q].set?k++:0==r[q].set?A++:2==r[q].set&&L++;var B=x.append("g").attr("transform",function(t,n){return"translate("+(h(1)+e/6)+","+o+")"});B.append("text").attr("x",0).attr("y",0).attr("dy",".35em").style("font-size",function(t){return"20px"}).text(function(t){return f(k/r.length)+" match"}).attr("transform",function(t,n){return"translate(0,-20)"}),B.append("rect").style("fill",function(t){return p.range()[1]}).attr("fill-opacity",1).attr("opacity",1).attr("height",10).attr("width",200).attr("rx",3).attr("ry",3).attr("x",0).attr("y",0).attr("transform",function(t,n){return"translate(-100,-10)"});var F=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){d3.format(".3s");return"<strong>"+t.name+":</strong> <p><span style='color:red'>"+t.value+"</span>"});x.call(F);var R=x.selectAll("gnode").data(w).enter().append("g").attr("class",function(t){return"gnode "+t.set}).on("mouseover",function(n){t(),x.selectAll(".gnode").sort(function(t,r){return t.name!=n.name?-1:1});var r=d3.select(this).selectAll("text").style("font-size");r=parseFloat(r),d3.select(this).selectAll("text").transition().duration(100).text(function(t){return t.name.replace(/\(.*?\)/,"")}).style("font-size",function(){return"18px"})}).on("mouseout",function(){t()}).call(z.drag),j=R.append("circle").attr("fill-opacity",0).attr("r",0).attr("stroke-opacity",0).style("fill",function(t){return t.color}).on("mouseover",F.show).on("mouseout",F.hide);j.transition().duration(2e3).attr("r",function(t){return t.radius});var S=R.append("text").attr("fill-opacity",0).text(function(t){return n(t.name)}).style("font-size",function(t){var r=this.getComputedTextLength();return 0==r&&(r=11*n(t.name).length),t.computedFontSize=Math.min(2*t.radius,(2*t.radius-8)/r*24)+"px",Math.min(2*t.radius,(2*t.radius-8)/r*24)+"px"}).attr("dy",".35em");j.attr("fill-opacity",.8),S.transition().duration(2e3).attr("fill-opacity",1),y(),d3.select(window).on("resize.chart",y)})}function n(t){var n=t.replace(/\(.*?\)/,"");return n.length>c&&(n=n.substr(0,c-3)+"..."),n}var r,e=600,a=500,o=520,i=6,s=25,u=65,l=3,c=22,d=70,f=d3.format(".0%"),m=[colorbrewer.Greens[9][4],colorbrewer.YlOrRd[9][2],colorbrewer.Reds[9][4]],p=d3.scale.ordinal().domain(d3.range(l)),h=d3.scale.ordinal().domain(d3.range(l)).rangeBands([0,e]),g=["","",""],y={};return t.data=function(n){return arguments.length?(r=n,t):r},t.setLabels=function(n){return arguments.length?(g=n,t):g},t.colorRange=function(n){return arguments.length?(m=n,t):m},t.maxCharLength=function(n){return arguments.length?(c=n,t):c},t}function drawChart(t,n){console.log(n),vennColumns=BlinkersVennColumnsChart().setLabels(["ingredients you have","ingredients in common","ingredients you need"]).data(n),d3.select("#chart").call(vennColumns)}queue().defer(d3.json,"data.json").await(drawChart);var tip=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"<strong>"+t.name+"</strong> <span style='color:red'>"+t.value+"</span>"});